---
title: "Configura√ß√£o Avan√ßada"
description: "Personalize regras do Vale e configure o servidor para suas necessidades espec√≠ficas"
date: "2025-10-24"
tags: ["configura√ß√£o", "vale", "regras", "personaliza√ß√£o", "avan√ßado"]
---

# ‚öôÔ∏è Configura√ß√£o Avan√ßada

Este guia mostra como personalizar o MCP Vale Server para suas necessidades espec√≠ficas, incluindo configura√ß√£o de regras, estilos customizados e otimiza√ß√µes.

## üìÅ Estrutura de Configura√ß√£o

```
mcp-writechoice-server/
‚îú‚îÄ‚îÄ vale.ini                 # Configura√ß√£o principal do Vale
‚îú‚îÄ‚îÄ styles/                  # Estilos de verifica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Google/             # Google Style Guide
‚îÇ   ‚îú‚îÄ‚îÄ proselint/          # Verifica√ß√µes de prosa
‚îÇ   ‚îú‚îÄ‚îÄ alex/               # Linguagem inclusiva
‚îÇ   ‚îú‚îÄ‚îÄ WC-Styles/          # Regras personalizadas
‚îÇ   ‚îî‚îÄ‚îÄ Aspect/             # Verifica√ß√£o ortogr√°fica
‚îú‚îÄ‚îÄ temp/                   # Arquivos tempor√°rios
‚îî‚îÄ‚îÄ src/                    # C√≥digo fonte do servidor
```

## üîß Configura√ß√£o do Vale (vale.ini)

### Arquivo Principal

O arquivo `vale.ini` controla todo o comportamento do Vale:

```ini
# MinAlertLevel = suggestion
StylesPath = styles

# Formatos de arquivo suportados
[formats]
mdx = md

# Configura√ß√£o global
[*]
# Estilos habilitados (ordem importa!)
BasedOnStyles = Vale, Google, proselint, alex, WC-Styles, Aspect

# Regras espec√≠ficas desabilitadas
Google.FirstPerson = NO
Google.Will = NO
Google.Headings = NO

# Configura√ß√µes de arquivo espec√≠ficas
[*.md]
# Regras espec√≠ficas para Markdown
Google.Headings = YES

[*.rst]
# Configura√ß√µes para reStructuredText
BasedOnStyles = Vale, Google, proselint

[*.{html,htm}]
# Configura√ß√µes para HTML
BasedOnStyles = Vale, Google
```

### N√≠veis de Alerta

```ini
# Controla quais tipos de problemas s√£o reportados
MinAlertLevel = suggestion  # suggestion, warning, error
```

- **`suggestion`**: Mostra tudo (padr√£o)
- **`warning`**: Apenas warnings e errors
- **`error`**: Apenas errors cr√≠ticos

### Configura√ß√µes por Tipo de Arquivo

```ini
# Documenta√ß√£o t√©cnica
[*.{md,mdx}]
BasedOnStyles = Vale, Google, proselint, alex, WC-Styles, Aspect
Google.FirstPerson = NO
WC-Styles.SentenceLength = YES

# Blog posts e artigos
[*.{blog,article}.md]
BasedOnStyles = Vale, Google, proselint, alex
Google.FirstPerson = YES
proselint.Hedging = NO

# Emails e comunica√ß√£o interna
[*.{email,memo}.md]
BasedOnStyles = Vale, alex
Google.We = NO
```

## üé® Estilos Dispon√≠veis

### 1. Vale (B√°sico)

Regras fundamentais do Vale inclu√≠das por padr√£o.

### 2. Google Style Guide

```ini
# Configura√ß√µes do Google Style
[*]
Google.FirstPerson = NO      # Evitar "I", "we", etc.
Google.Will = NO             # Evitar tempo futuro com "will"
Google.Passive = YES         # Detectar voz passiva
Google.WordList = YES        # Palavras preferidas/evitadas
Google.Acronyms = YES        # Formato de acr√¥nimos
```

### 3. proselint

Verifica√ß√µes de qualidade de prosa:

```ini
[*]
proselint.Hedging = YES          # "kind of", "sort of"
proselint.Jargon = YES           # Jarg√£o t√©cnico
proselint.Redundancy = YES       # Redund√¢ncias
proselint.Skunked = YES          # Palavras controversas
proselint.Typography = YES       # Tipografia correta
```

### 4. alex

Linguagem inclusiva e n√£o ofensiva:

```ini
[*]
alex.Condescending = YES    # Linguagem condescendente
alex.Gendered = YES         # Linguagem de g√™nero
alex.LGBTQ = YES           # Terminologia LGBTQ+
alex.Race = YES            # Terminologia racial
alex.ProfanityLikely = YES # Poss√≠vel profanidade
```

### 5. WC-Styles (Personalizado)

Regras espec√≠ficas do WriteChoice:

```ini
[*]
WC-Styles.SentenceLength = YES      # M√°x 20 palavras por frase
WC-Styles.PlainLanguage = YES       # Linguagem simples
WC-Styles.FillerWords = YES         # Palavras de preenchimento
WC-Styles.SecondPerson = YES        # Uso de "voc√™"
```

### 6. Aspect

Verifica√ß√£o ortogr√°fica:

```ini
[*]
Aspect.Spelling = YES       # Verifica√ß√£o ortogr√°fica
```

## üî® Criando Regras Personalizadas

### Estrutura de uma Regra

Crie um arquivo YAML na pasta `styles/SeuEstilo/`:

```yaml
# styles/MeuEstilo/MinhaRegra.yml
extends: existence
message: "Evite usar '%s'."
level: warning
tokens:
  - obviously
  - basically
  - simply
  - just
```

### Tipos de Regras

#### 1. Existence (Exist√™ncia)

Detecta palavras ou frases espec√≠ficas:

```yaml
# styles/MeuEstilo/PalavrasEvitadas.yml
extends: existence
message: "Considere uma alternativa para '%s'."
level: suggestion
ignorecase: true
tokens:
  - utilize  # prefira "use"
  - leverage # prefira "use"
  - paradigm # seja mais espec√≠fico
```

#### 2. Substitution (Substitui√ß√£o)

Sugere substitui√ß√µes:

```yaml
# styles/MeuEstilo/Substituicoes.yml
extends: substitution
message: "Use '%s' em vez de '%s'."
level: error
ignorecase: true
swap:
  alot: a lot
  recieve: receive
  seperate: separate
```

#### 3. Occurrence (Ocorr√™ncia)

Controla frequ√™ncia de palavras:

```yaml
# styles/MeuEstilo/Repeticao.yml
extends: occurrence
message: "'%s' aparece muito frequentemente."
level: warning
max: 3
tokens:
  - very
  - really
  - quite
```

#### 4. Repetition (Repeti√ß√£o)

Detecta palavras repetidas:

```yaml
# styles/MeuEstilo/PalavrasRepetidas.yml
extends: repetition
message: "Palavra '%s' repetida."
level: warning
alpha: true
tokens:
  - '\b(\w+)\s+\1\b'
```

#### 5. Consistency (Consist√™ncia)

Garante uso consistente:

```yaml
# styles/MeuEstilo/Consistencia.yml
extends: consistency
message: "Use '%s' consistentemente."
level: warning
either:
  advisor: adviser
  centre: center
  grey: gray
```

#### 6. Conditional (Condicional)

Regras baseadas em contexto:

```yaml
# styles/MeuEstilo/Condicional.yml
extends: conditional
message: "Use 'an' antes de '%s'."
level: error
first: '\ba\s'
second: '(?i)hour|honest|honor'
exceptions:
  - "a historical"
  - "a hypothesis"
```

### Exemplo Completo: Estilo Corporativo

```yaml
# styles/Corporativo/Jargao.yml
extends: substitution
message: "Use linguagem mais clara: '%s' em vez de '%s'."
level: warning
ignorecase: true
swap:
  leverage: use
  utilize: use
  facilitate: help
  implement: do
  synergy: cooperation
  paradigm: model
  ecosystem: environment
  best practice: good method
  game changer: important change
  deep dive: detailed analysis
```

```yaml
# styles/Corporativo/Clareza.yml
extends: existence
message: "Evite jarg√£o corporativo: '%s'."
level: suggestion
ignorecase: true
tokens:
  - "low-hanging fruit"
  - "think outside the box"
  - "circle back"
  - "touch base"
  - "move the needle"
  - "drill down"
```

## üéØ Configura√ß√µes Espec√≠ficas por Contexto

### Documenta√ß√£o T√©cnica

```ini
[*.{api,technical}.md]
BasedOnStyles = Vale, Google, WC-Styles, Aspect
# Permitir primeira pessoa em tutoriais
Google.FirstPerson = NO
# Sentences mais longas s√£o OK para documenta√ß√£o t√©cnica
WC-Styles.SentenceLength = NO
# Permitir jarg√£o t√©cnico
proselint.Jargon = NO
```

### Marketing e Vendas

```ini
[*.{marketing,sales}.md]
BasedOnStyles = Vale, proselint, alex, Aspect
# Permitir linguagem persuasiva
proselint.Hedging = NO
# Linguagem inclusiva √© cr√≠tica
alex.Gendered = YES
alex.Race = YES
```

### Comunica√ß√£o Interna

```ini
[*.{memo,internal}.md]
BasedOnStyles = Vale, alex, Aspect
# Comunica√ß√£o mais relaxada
Google.Contractions = NO
# Foco em inclusividade
alex.Condescending = YES
```

## üîç Configura√ß√£o de Vocabul√°rio

### Arquivo de Vocabul√°rio

Crie `styles/SeuEstilo/vocab.txt`:

```
# Palavras aceitas (uma por linha)
API
JSON
REST
GraphQL
microservices
frontend
backend
DevOps
```

### Uso em Regras

```yaml
# styles/SeuEstilo/Vocabulario.yml
extends: spelling
message: "Palavra n√£o reconhecida: '%s'."
level: error
filters:
  - vocabulary
```

## üöÄ Otimiza√ß√µes de Performance

### Configura√ß√£o do Servidor

```typescript
// src/vale-service.ts - Configura√ß√µes customizadas
export class ValeService {
  private valeConfigPath: string;
  private cacheResults: boolean = true;
  private maxCacheSize: number = 100;
  
  constructor(configPath: string, options?: {
    cache?: boolean;
    maxCacheSize?: number;
  }) {
    this.valeConfigPath = configPath;
    this.cacheResults = options?.cache ?? true;
    this.maxCacheSize = options?.maxCacheSize ?? 100;
  }
}
```

### Cache de Resultados

```typescript
// Implementa√ß√£o de cache simples
private resultCache = new Map<string, any>();

private getCacheKey(text: string, fileName: string): string {
  return `${fileName}:${text.slice(0, 100)}`;
}

async lintTextWithVale(text: string, fileName: string) {
  const cacheKey = this.getCacheKey(text, fileName);
  
  if (this.cacheResults && this.resultCache.has(cacheKey)) {
    return this.resultCache.get(cacheKey);
  }
  
  const result = await this.performLinting(text, fileName);
  
  if (this.cacheResults) {
    this.resultCache.set(cacheKey, result);
    // Limitar tamanho do cache
    if (this.resultCache.size > this.maxCacheSize) {
      const firstKey = this.resultCache.keys().next().value;
      this.resultCache.delete(firstKey);
    }
  }
  
  return result;
}
```

## üìä Configura√ß√£o de Logging

### N√≠veis de Log

```typescript
// src/index.ts
const LOG_LEVEL = process.env.LOG_LEVEL || 'info';

enum LogLevel {
  ERROR = 0,
  WARN = 1,
  INFO = 2,
  DEBUG = 3
}

function log(level: LogLevel, message: string, data?: any) {
  const levels = ['ERROR', 'WARN', 'INFO', 'DEBUG'];
  if (level <= LogLevel[LOG_LEVEL.toUpperCase() as keyof typeof LogLevel]) {
    console.error(`[${levels[level]}] ${message}`, data || '');
  }
}
```

### Vari√°veis de Ambiente

```bash
# .env
LOG_LEVEL=debug              # error, warn, info, debug
VALE_CONFIG_PATH=./vale.ini  # Caminho do config
TEMP_DIR=./temp             # Diret√≥rio tempor√°rio
CACHE_ENABLED=true          # Habilitar cache
MAX_CACHE_SIZE=100          # Tamanho m√°ximo do cache
```

## üîß Configura√ß√£o de Deployment

### Docker

```dockerfile
# Dockerfile.production
FROM node:18-alpine

# Instalar Vale
RUN wget -O- https://github.com/errata-ai/vale/releases/latest/download/vale_Linux_64-bit.tar.gz | tar -xz -C /usr/local/bin

WORKDIR /app

# Copiar configura√ß√µes
COPY vale.ini ./
COPY styles/ ./styles/
COPY package*.json ./

# Instalar depend√™ncias
RUN npm ci --only=production

# Copiar c√≥digo compilado
COPY dist/ ./dist/

# Configurar usu√°rio n√£o-root
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001
USER nextjs

EXPOSE 3000

CMD ["npm", "start"]
```

### Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  mcp-vale-server:
    build: .
    ports:
      - "3000:3000"
    environment:
      - LOG_LEVEL=info
      - CACHE_ENABLED=true
    volumes:
      - ./styles:/app/styles:ro
      - ./vale.ini:/app/vale.ini:ro
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - mcp-vale-server
```

## üìà Monitoramento e M√©tricas

### Configura√ß√£o de Health Check

```typescript
// src/health.ts
export interface HealthStatus {
  status: 'healthy' | 'unhealthy';
  version: string;
  uptime: number;
  vale: {
    installed: boolean;
    version?: string;
    configPath: string;
  };
  memory: {
    used: number;
    total: number;
  };
}

export async function getHealthStatus(): Promise<HealthStatus> {
  const valeStatus = await checkValeInstallation();
  const memUsage = process.memoryUsage();
  
  return {
    status: valeStatus.installed ? 'healthy' : 'unhealthy',
    version: process.env.npm_package_version || '1.0.0',
    uptime: process.uptime(),
    vale: {
      installed: valeStatus.installed,
      version: valeStatus.version,
      configPath: process.env.VALE_CONFIG_PATH || './vale.ini'
    },
    memory: {
      used: memUsage.heapUsed,
      total: memUsage.heapTotal
    }
  };
}
```