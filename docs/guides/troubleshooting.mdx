---
title: "Troubleshooting"
description: "Resolva problemas comuns do MCP Vale Server rapidamente"
date: "2025-10-24"
tags: ["troubleshooting", "problemas", "debug", "solu√ß√£o", "ajuda"]
---

# üîç Troubleshooting

Este guia ajuda a resolver os problemas mais comuns do MCP Vale Server. Organize por categoria para encontrar solu√ß√µes rapidamente.

## üö® Problemas de Instala√ß√£o

### Vale n√£o encontrado

**Sintomas:**
- Erro: "Vale is not installed or not found in PATH"
- Comando `vale --version` falha

**Solu√ß√µes:**

import { Tabs, Tab } from '@/components/ui/tabs'

<Tabs defaultValue="macos">
  <Tab value="macos" label="macOS">
    ```bash
    # Verificar se Homebrew est√° instalado
    brew --version
    
    # Instalar Vale
    brew install vale
    
    # Verificar instala√ß√£o
    vale --version
    
    # Se ainda n√£o funcionar, adicionar ao PATH
    echo 'export PATH="/opt/homebrew/bin:$PATH"' >> ~/.zshrc
    source ~/.zshrc
    ```
  </Tab>
  <Tab value="ubuntu" label="Ubuntu/Debian">
    ```bash
    # M√©todo 1: Reposit√≥rio oficial
    sudo apt update
    sudo apt install vale
    
    # M√©todo 2: Download direto
    wget https://github.com/errata-ai/vale/releases/latest/download/vale_Linux_64-bit.tar.gz
    tar -xzf vale_Linux_64-bit.tar.gz
    sudo mv vale /usr/local/bin/
    
    # Verificar
    vale --version
    ```
  </Tab>
  <Tab value="windows" label="Windows">
    ```bash
    # Com Chocolatey
    choco install vale
    
    # Com Scoop
    scoop install vale
    
    # Download manual
    # Baixe de: https://github.com/errata-ai/vale/releases
    # Extraia e adicione ao PATH
    ```
  </Tab>
</Tabs>

### Node.js n√£o encontrado

**Sintomas:**
- Erro: "node: command not found"
- `npm` n√£o funciona

**Solu√ß√µes:**

```bash
# Verificar vers√£o do Node.js
node --version  # Deve ser v18+

# Instalar Node.js via nvm (recomendado)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18

# Ou via gerenciador de pacotes
# macOS: brew install node
# Ubuntu: sudo apt install nodejs npm
```

### Depend√™ncias n√£o instaladas

**Sintomas:**
- Erro: "Cannot find module"
- `npm start` falha

**Solu√ß√µes:**

```bash
# Limpar cache e reinstalar
rm -rf node_modules package-lock.json
npm cache clean --force
npm install

# Verificar vers√µes
npm --version
node --version

# Recompilar
npm run build
```

## ‚öôÔ∏è Problemas de Configura√ß√£o

### Arquivo vale.ini n√£o encontrado

**Sintomas:**
- Erro: "Config file not found"
- Vale executa mas n√£o aplica regras

**Diagn√≥stico:**

```bash
# Verificar se o arquivo existe
ls -la vale.ini

# Verificar caminho absoluto
pwd
```

**Solu√ß√µes:**

```bash
# Certificar que est√° no diret√≥rio correto
cd /caminho/para/mcp-writechoice-server

# Verificar conte√∫do do vale.ini
cat vale.ini

# Recriar se necess√°rio
cp vale.ini.example vale.ini  # se existir
```

### Estilos n√£o carregados

**Sintomas:**
- Vale executa mas n√£o encontra problemas √≥bvios
- Mensagem sobre estilos n√£o encontrados

**Diagn√≥stico:**

```bash
# Verificar estrutura de pastas
ls -la styles/

# Testar Vale diretamente
vale --config=vale.ini exemplo-teste.md
```

**Solu√ß√µes:**

```bash
# Verificar se pastas de estilos existem
ls styles/Google styles/proselint styles/alex

# Recriar estilos se necess√°rio
mkdir -p styles/{Google,proselint,alex,WC-Styles,Aspect}

# Verificar permiss√µes
chmod -R 755 styles/
```

### Configura√ß√£o MCP incorreta

**Sintomas:**
- Claude Desktop n√£o mostra ferramentas do Vale
- Erro de conex√£o MCP

**Diagn√≥stico:**

```bash
# Verificar compila√ß√£o
npm run build
ls -la dist/

# Testar servidor MCP manualmente
node dist/index.js
# Deve mostrar: "MCP Vale server running on stdio"
```

**Solu√ß√µes:**

1. **Verificar caminhos absolutos** no config do Claude:

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "node",
      "args": ["/caminho/completo/para/dist/index.js"],
      "env": {
        "VALE_CONFIG_PATH": "/caminho/completo/para/vale.ini"
      }
    }
  }
}
```

2. **Testar com caminho expl√≠cito:**

```bash
# Obter caminho absoluto
pwd
# Use esse caminho completo no config
```

3. **Verificar permiss√µes:**

```bash
chmod +x dist/index.js
```

## üåê Problemas da API HTTP

### Servidor n√£o inicia

**Sintomas:**
- `npm run http` falha
- Erro de porta em uso

**Diagn√≥stico:**

```bash
# Verificar se porta est√° em uso
lsof -i :3000
netstat -tulpn | grep 3000

# Verificar logs de erro
npm run http 2>&1 | tee server.log
```

**Solu√ß√µes:**

```bash
# Usar porta alternativa
PORT=3001 npm run http

# Matar processo na porta 3000
kill -9 $(lsof -ti:3000)

# Verificar se Express est√° instalado
npm list express
```

### CORS errors

**Sintomas:**
- Erro de CORS no navegador
- Interface web n√£o consegue acessar API

**Solu√ß√µes:**

Verificar configura√ß√£o CORS no `http-server-simple.js`:

```javascript
// Deve conter estas headers
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');
  
  if (req.method === 'OPTIONS') {
    res.sendStatus(200);
  } else {
    next();
  }
});
```

### Requisi√ß√µes falham

**Sintomas:**
- Timeout em requests
- Respostas vazias

**Diagn√≥stico:**

```bash
# Testar conectividade b√°sica
curl http://localhost:3000/test

# Testar com verbose
curl -v http://localhost:3000/vale/status

# Verificar logs do servidor
npm run http | tee -a debug.log
```

## ü§ñ Problemas do Protocolo MCP

### Claude Desktop n√£o reconhece servidor

**Sintomas:**
- Ferramentas n√£o aparecem no Claude
- Erro de conex√£o no log

**Diagn√≥stico:**

```bash
# Verificar se arquivo de config existe
ls -la ~/Library/Application\ Support/Claude/claude_desktop_config.json  # macOS
ls -la ~/.config/Claude/claude_desktop_config.json  # Linux

# Validar JSON
cat claude_desktop_config.json | jq .
```

**Solu√ß√µes:**

1. **Recriar configura√ß√£o:**

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "node",
      "args": ["/Users/seu-usuario/caminho/para/mcp-writechoice-server/dist/index.js"],
      "env": {
        "VALE_CONFIG_PATH": "/Users/seu-usuario/caminho/para/mcp-writechoice-server/vale.ini"
      }
    }
  }
}
```

2. **Verificar permiss√µes:**

```bash
chmod 644 claude_desktop_config.json
```

3. **Reiniciar Claude completamente:**
   - Fechar aplica√ß√£o
   - Aguardar 10 segundos
   - Reabrir

### Ferramentas aparecem mas falham

**Sintomas:**
- Claude mostra ferramentas dispon√≠veis
- Execu√ß√£o resulta em erro

**Diagn√≥stico:**

```bash
# Testar servidor MCP diretamente
echo '{"method":"tools/list","id":1}' | node dist/index.js

# Verificar logs do Claude Desktop
tail -f ~/Library/Logs/Claude/claude-desktop.log  # macOS
```

**Solu√ß√µes:**

1. **Recompilar projeto:**

```bash
npm run build
```

2. **Verificar vari√°veis de ambiente:**

```bash
# Testar com env expl√≠cito
VALE_CONFIG_PATH=./vale.ini node dist/index.js
```

3. **Verificar compatibilidade MCP:**

```bash
npm list @modelcontextprotocol/sdk
# Deve ser vers√£o compat√≠vel
```

## üì± Problemas da Interface Web

### P√°gina n√£o carrega

**Sintomas:**
- 404 ao acessar interface web
- P√°gina em branco

**Diagn√≥stico:**

```bash
# Verificar se servidor web est√° rodando
curl http://localhost:8080/

# Verificar se arquivo existe
ls -la web-interface.html
```

**Solu√ß√µes:**

```bash
# Iniciar servidor web
npm run web

# Ou usar Python
python3 -m http.server 8080

# Acessar URL correta
open http://localhost:8080/web-interface.html
```

### Interface carrega mas an√°lise falha

**Sintomas:**
- Interface aparece normalmente
- Bot√£o "Analisar" n√£o funciona

**Diagn√≥stico:**

```bash
# Verificar se API est√° rodando
curl http://localhost:3000/test

# Verificar console do navegador (F12)
# Procurar por erros em vermelho
```

**Solu√ß√µes:**

1. **Iniciar ambos servidores:**

```bash
npm run start-npm
# Ou separadamente:
npm run http    # Terminal 1
npm run web     # Terminal 2
```

2. **Verificar CORS** (ver se√ß√£o anterior)

3. **Testar API diretamente:**

```bash
curl -X POST http://localhost:3000/vale/lint \
  -H "Content-Type: application/json" \
  -d '{"text":"test"}'
```

## üêõ Debug Avan√ßado

### Habilitando Logs Detalhados

```bash
# Definir n√≠vel de log
export LOG_LEVEL=debug

# Executar com logs detalhados
DEBUG=* npm run http

# Ou para MCP
DEBUG=mcp:* node dist/index.js
```

### Verifica√ß√£o Sistem√°tica

Use este checklist para diagn√≥stico completo:

```bash
#!/bin/bash
echo "=== Diagn√≥stico do MCP Vale Server ==="

echo "1. Verificando Node.js..."
node --version || echo "‚ùå Node.js n√£o instalado"

echo "2. Verificando npm..."
npm --version || echo "‚ùå npm n√£o instalado"

echo "3. Verificando Vale..."
vale --version || echo "‚ùå Vale n√£o instalado"

echo "4. Verificando arquivos de configura√ß√£o..."
[ -f vale.ini ] && echo "‚úÖ vale.ini encontrado" || echo "‚ùå vale.ini n√£o encontrado"
[ -d styles ] && echo "‚úÖ Pasta styles encontrada" || echo "‚ùå Pasta styles n√£o encontrada"
[ -d dist ] && echo "‚úÖ Pasta dist encontrada" || echo "‚ùå Projeto n√£o compilado"

echo "5. Verificando depend√™ncias..."
npm list --depth=0 2>/dev/null | grep -E "(express|@modelcontextprotocol)" || echo "‚ùå Depend√™ncias faltando"

echo "6. Testando Vale diretamente..."
echo "This is a test." > test.md
vale --config=vale.ini test.md && echo "‚úÖ Vale funcionando" || echo "‚ùå Vale com problemas"
rm test.md

echo "7. Testando servidor MCP..."
timeout 5s node dist/index.js >/dev/null 2>&1 && echo "‚úÖ Servidor MCP inicia" || echo "‚ùå Servidor MCP falha"

echo "=== Diagn√≥stico conclu√≠do ==="
```

### Arquivo de Log Personalizado

```typescript
// src/logger.ts
import fs from 'fs';
import path from 'path';

class Logger {
  private logFile: string;
  
  constructor() {
    this.logFile = path.join(process.cwd(), 'debug.log');
  }
  
  log(level: string, message: string, data?: any) {
    const timestamp = new Date().toISOString();
    const logEntry = `[${timestamp}] ${level}: ${message}`;
    
    console.log(logEntry, data || '');
    
    // Salvar em arquivo
    fs.appendFileSync(this.logFile, logEntry + '\n');
  }
  
  error(message: string, error?: any) {
    this.log('ERROR', message, error);
  }
  
  warn(message: string, data?: any) {
    this.log('WARN', message, data);
  }
  
  info(message: string, data?: any) {
    this.log('INFO', message, data);
  }
  
  debug(message: string, data?: any) {
    if (process.env.DEBUG || process.env.LOG_LEVEL === 'debug') {
      this.log('DEBUG', message, data);
    }
  }
}

export const logger = new Logger();
```

## üÜò Quando Buscar Ajuda

Se os problemas persistem ap√≥s seguir este guia:

### 1. Coleta de Informa√ß√µes

Antes de reportar um problema, colete:

```bash
# Informa√ß√µes do sistema
uname -a                    # Sistema operacional
node --version             # Vers√£o do Node.js
npm --version              # Vers√£o do npm
vale --version             # Vers√£o do Vale

# Status do projeto
git status                 # Status do git
npm list --depth=0         # Depend√™ncias instaladas
ls -la dist/              # Arquivos compilados

# Logs de erro
tail -n 50 debug.log      # √öltimos logs
```

### 2. Onde Buscar Ajuda

- üìö [Documenta√ß√£o do Vale](https://vale.sh/docs/)
- üêõ [Issues no GitHub](https://github.com/writechoiceorg/mcp-writechoice-server/issues)
- üí¨ [Discuss√µes](https://github.com/writechoiceorg/mcp-writechoice-server/discussions)
- üîß [MCP Documentation](https://modelcontextprotocol.io/)

### 3. Como Reportar Problemas

Inclua sempre:

1. **Descri√ß√£o clara** do problema
2. **Passos para reproduzir**
3. **Mensagens de erro** completas
4. **Informa√ß√µes do sistema** (coletadas acima)
5. **Configura√ß√£o utilizada** (vale.ini, config MCP)

## ‚úÖ Preven√ß√£o de Problemas

### Verifica√ß√µes Regulares

```bash
# Script de verifica√ß√£o semanal
#!/bin/bash
echo "Verificando atualiza√ß√µes..."
npm outdated
vale --version

echo "Verificando integridade..."
npm run build
npm run test  # se houver testes

echo "Limpando cache..."
npm cache clean --force
```

### Backup de Configura√ß√µes

```bash
# Backup autom√°tico
cp vale.ini vale.ini.backup.$(date +%Y%m%d)
cp claude_desktop_config.json claude_desktop_config.json.backup.$(date +%Y%m%d)
```
