---
title: "Guia do Protocolo MCP"
description: "Integre o Vale com assistentes IA usando Model Context Protocol"
date: "2025-10-24"
tags: ["mcp", "ai", "claude", "protocol", "assistente"]
---

# ü§ñ Guia do Protocolo MCP

O Model Context Protocol (MCP) permite que assistentes IA como Claude Desktop usem o Vale diretamente para verifica√ß√£o de texto. Este guia mostra como configurar e usar essa integra√ß√£o.

## O que √© MCP?

O **Model Context Protocol** √© um padr√£o aberto que permite:
- üîó **Conectar assistentes IA** com ferramentas externas
- üì° **Comunica√ß√£o bidirecional** entre IA e servi√ßos
- üõ†Ô∏è **Execu√ß√£o de ferramentas** em tempo real
- üîê **Acesso controlado** a recursos externos

## Configura√ß√µes Suportadas

### 1. Claude Desktop (Recomendado)

A integra√ß√£o mais popular e f√°cil de configurar.

### 2. Clientes MCP Customizados

Para desenvolvedores que querem criar suas pr√≥prias integra√ß√µes.

### 3. Python Client

Cliente de exemplo inclu√≠do no projeto.

## üöÄ Configura√ß√£o do Claude Desktop

### Pr√©-requisitos

1. **Claude Desktop** instalado
2. **MCP Vale Server** compilado
3. **Vale** instalado no sistema

### Passo 1: Compilar o Servidor

```bash
cd mcp-writechoice-server
npm install
npm run build
```

### Passo 2: Localizar Arquivo de Configura√ß√£o

O Claude Desktop usa um arquivo de configura√ß√£o JSON:

import { Tabs, Tab } from '@/components/ui/tabs'

<Tabs defaultValue="macos">
  <Tab value="macos" label="macOS">
    ```bash
    ~/Library/Application Support/Claude/claude_desktop_config.json
    ```
  </Tab>
  <Tab value="windows" label="Windows">
    ```bash
    %APPDATA%\Claude\claude_desktop_config.json
    ```
  </Tab>
  <Tab value="linux" label="Linux">
    ```bash
    ~/.config/Claude/claude_desktop_config.json
    ```
  </Tab>
</Tabs>

### Passo 3: Configurar o MCP Server

Crie ou edite o arquivo de configura√ß√£o:

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "node",
      "args": ["/caminho/completo/para/mcp-writechoice-server/dist/index.js"],
      "env": {
        "VALE_CONFIG_PATH": "/caminho/completo/para/mcp-writechoice-server/vale.ini"
      }
    }
  }
}
```

**‚ö†Ô∏è Importante:** Use caminhos absolutos completos!

### Exemplo de Configura√ß√£o Completa

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "node",
      "args": ["/Users/usuario/projetos/mcp-writechoice-server/dist/index.js"],
      "env": {
        "VALE_CONFIG_PATH": "/Users/usuario/projetos/mcp-writechoice-server/vale.ini"
      }
    }
  }
}
```

### Passo 4: Reiniciar Claude Desktop

1. **Feche completamente** o Claude Desktop
2. **Reabra** o aplicativo
3. **Verifique** se o servidor foi carregado (deve aparecer na lista de ferramentas)

## ‚úÖ Verifica√ß√£o da Instala√ß√£o

### No Claude Desktop

Voc√™ deve ver uma nova ferramenta dispon√≠vel:

```
üîß Ferramentas Dispon√≠veis:
- lint_text
- check_vale_status
```

### Teste B√°sico

Digite no Claude Desktop:

```
Por favor, analise este texto usando Vale:

"Their are many problems in this sentance."
```

**Resposta esperada:**
```
Vou analisar seu texto usando o Vale...

Vale Lint Results for document.md
Total Issues: 2

üö® ERRORS (2):
  Line 1: 'Their' is incorrect. Use 'There' instead. (Aspect.Spelling)
  Line 1: 'sentance' is incorrect. Use 'sentence' instead. (Aspect.Spelling)

üìä Analysis Summary:
- Text analyzed successfully
- Found 2 spelling errors that should be corrected
```

## üõ†Ô∏è Ferramentas MCP Dispon√≠veis

### 1. `lint_text`

Analisa texto usando Vale.

**Par√¢metros:**
- `text` (obrigat√≥rio): Texto para an√°lise
- `fileName` (opcional): Nome do arquivo (padr√£o: "document.md")

**Exemplo de uso no Claude:**
```
Analise este email corporativo usando Vale:

"Hi team, we need to finalize the project ASAP. Their are some issues that need fixing."
```

### 2. `check_vale_status`

Verifica se o Vale est√° funcionando.

**Sem par√¢metros**

**Exemplo de uso no Claude:**
```
Verifique se o Vale est√° funcionando corretamente.
```

## üéØ Casos de Uso Pr√°ticos

### 1. Revis√£o de Documentos

```
Claude, por favor analise este relat√≥rio e me d√™ sugest√µes de melhoria:

[Cole seu texto aqui]
```

### 2. Verifica√ß√£o de Emails

```
Antes de enviar este email importante, voc√™ pode verificar o estilo e gram√°tica?

[Cole o email aqui]
```

### 3. An√°lise de Conte√∫do Web

```
Analise este conte√∫do do blog para garantir que est√° seguindo boas pr√°ticas de escrita:

[Cole o conte√∫do aqui]
```

### 4. Revis√£o de C√≥digo de Documenta√ß√£o

```
Verifique a documenta√ß√£o deste README para melhorar a clareza:

[Cole a documenta√ß√£o aqui]
```

## üêç Cliente Python

O projeto inclui um cliente Python de exemplo:

### Instala√ß√£o

```bash
pip install mcp
```

### Exemplo de Uso

```python
# test_client.py (inclu√≠do no projeto)
import asyncio
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    # Configurar par√¢metros do servidor
    server_params = StdioServerParameters(
        command="node",
        args=["./dist/index.js"],
        env={"VALE_CONFIG_PATH": "./vale.ini"}
    )
    
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(read, write) as session:
            # Inicializar o cliente
            await session.initialize()
            
            # Listar ferramentas dispon√≠veis
            tools = await session.list_tools()
            print("Ferramentas dispon√≠veis:")
            for tool in tools.tools:
                print(f"- {tool.name}: {tool.description}")
            
            # Analisar texto
            result = await session.call_tool(
                "lint_text",
                arguments={
                    "text": "This is a sample text with potencial issues.",
                    "fileName": "test.md"
                }
            )
            
            print("\nResultado da an√°lise:")
            for content in result.content:
                print(content.text)

if __name__ == "__main__":
    asyncio.run(main())
```

### Executar o Cliente

```bash
python test_client.py
```

## üîß Desenvolvimento de Clientes Customizados

### Esquema das Ferramentas

```typescript
// lint_text
{
  name: "lint_text",
  description: "Lint text content using Vale style checker",
  inputSchema: {
    type: "object",
    properties: {
      text: {
        type: "string",
        description: "The text content to lint"
      },
      fileName: {
        type: "string", 
        description: "Optional filename for the text (default: document.md)"
      }
    },
    required: ["text"]
  }
}

// check_vale_status
{
  name: "check_vale_status",
  description: "Check if Vale is installed and working properly",
  inputSchema: {
    type: "object",
    properties: {}
  }
}
```

### Cliente Node.js Customizado

```javascript
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';
import { spawn } from 'child_process';

async function createValeClient() {
    const serverProcess = spawn('node', ['./dist/index.js'], {
        env: { ...process.env, VALE_CONFIG_PATH: './vale.ini' }
    });
    
    const transport = new StdioClientTransport({
        stdin: serverProcess.stdin,
        stdout: serverProcess.stdout
    });
    
    const client = new Client(
        { name: 'vale-client', version: '1.0.0' },
        { capabilities: {} }
    );
    
    await client.connect(transport);
    return { client, serverProcess };
}

async function lintText(text, fileName = 'document.md') {
    const { client, serverProcess } = await createValeClient();
    
    try {
        const result = await client.request(
            { method: 'tools/call' },
            {
                name: 'lint_text',
                arguments: { text, fileName }
            }
        );
        
        return result.content[0].text;
    } finally {
        serverProcess.kill();
    }
}

// Uso
lintText('This is a test sentance.').then(console.log);
```

## üö´ Solu√ß√£o de Problemas

### Servidor n√£o aparece no Claude

1. **Verifique os caminhos** no arquivo de configura√ß√£o
   ```bash
   # Teste se o arquivo existe
   ls -la /caminho/para/dist/index.js
   ```

2. **Valide o JSON** de configura√ß√£o
   ```bash
   cat ~/.../claude_desktop_config.json | jq .
   ```

3. **Verifique as permiss√µes**
   ```bash
   chmod +x /caminho/para/dist/index.js
   ```

4. **Reinicie completamente** o Claude Desktop

### Erro "Vale not found"

1. **Verifique instala√ß√£o do Vale**
   ```bash
   vale --version
   ```

2. **Confirme o PATH** no ambiente MCP
   ```json
   {
     "env": {
       "VALE_CONFIG_PATH": "./vale.ini",
       "PATH": "/usr/local/bin:/usr/bin:/bin"
     }
   }
   ```

### Servidor trava ou n√£o responde

1. **Teste manualmente**
   ```bash
   node ./dist/index.js
   # Deve mostrar: "MCP Vale server running on stdio"
   ```

2. **Verifique logs** do Claude Desktop
   - macOS: `~/Library/Logs/Claude/`
   - Windows: `%APPDATA%\Claude\Logs\`

3. **Recompile o projeto**
   ```bash
   npm run build
   ```

## üîÆ Recursos Avan√ßados

### Configura√ß√£o com M√∫ltiplos Servidores

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "node",
      "args": ["/path/to/mcp-writechoice-server/dist/index.js"],
      "env": {
        "VALE_CONFIG_PATH": "/path/to/vale.ini"
      }
    },
    "outro-servidor": {
      "command": "python",
      "args": ["/path/to/outro-servidor.py"]
    }
  }
}
```

### Configura√ß√£o com Docker

```json
{
  "mcpServers": {
    "mcp-vale-server": {
      "command": "docker",
      "args": [
        "run", "--rm", "-i",
        "-v", "/local/vale.ini:/app/vale.ini",
        "mcp-vale-server"
      ]
    }
  }
}
```